---
Type:
aliases: 
tags: 
modifiedDate: 2025/07/04, 17:48:21
---

# 光追面经

## 什么是蒙特卡洛积分方法 ？

[[渲染方程]]中包含一个递归积分项, 无法直接求出解析解, 需要使用数值积分方法进行估计. 一般使用蒙特卡洛积分方法. 
[[蒙特卡洛积分]]使用随机抽样来近似计算定积分, 根据大数定律, 其结果是无偏的. 
通常使用重要性采样等方法优化采样分布

## 怎么理解光线追踪中的重要性采样？如何实现重要性采样？

对于蒙特卡洛积分, 可由数学上推导出当采样的分布越接近被积函数函数形状时, 收敛速度越快, 即方差越小. 
这种选取恰当的概率密度函数 px 使其形状与被积函数相似的做法就叫[[重要性采样]]. 

### 1. 概率密度函数的选择

对于 px 的选择, 通常有几种做法
- 根据 brdf 和余弦项
- 余弦项
- 直接对场景中的光源发射几条光线
- MIS 综合各种策略
    - 由于实际情况中的被积函数 fx 十分复杂, 单一的 概率密度函数难以近似. 可以使用若干项的结合. 分别对 brdf, 几何项, 可见性等找到 px 并组合

注意 无法使用 Li 进行重要性采样, **因为 Li 是未知的**. 

### 2. 生成符合分布的样本

- 反函数变换采样 即求逆 CDF. 
    - 能使方差最小, 效率极高. 
    - 但通常算不出来. 对于复杂的 `p(x)`，计算其CDF的积分和反函数可能非常困难，甚至**没有解析解**。
- [[拒绝采样]]
    - 很通用
    - 如果形状差距大, 效率差
- 马尔可夫链
    - 功能极其强大，是现代统计学和机器学习的基石，能处理各种棘手的分布。
    - 理论和实现都复杂
- [[重要性重采样]]
    - 有时候, 选择的 px 难以从中生成样本, 这时候就可以使用重要性重采样算法, 利用一个更简单的已知的分布 qx 去近似 px
    - 利用 qx 生成 n 个样本, 对每个样本计算其权重

      $$w(x_i)=\frac{p(x_i)}{q(x_i)}$$

      这里, 如果 `px>qx` 说明, 这里欠采样, 权重应该增大.
    - 归一化权重, 根据权重对 n 个样本进行采样
    - 这样采样出的样本就近似于分布 px

### 3. 用得到的样本积分

## 路径追踪的去噪方法，是否了解过基于采样的去噪方法

即通过改进采样策略，来降低蒙特卡洛估计的方差。方法有：
- [[MIS]] 多重重要性采样
- [[RIS]] 重采样重要性采样
- [[ReSTIR]] 基于蓄水池的时空重要性采样

## RayMarching 原理

[[RayMarching]]

## RayTracing的原理

[[光线追踪|Ray Tracing]]
它通过模拟光线（Ray）在三维场景中传播、与物体交互的物理路径，来生成高度逼真的图像。
核心思想是逆向追踪从摄像机发出的光线, 通过计算光线和场景中的交点和光照, 逐像素合成图像

## RayMarch 和 RayTracing有何区别？

RayMarching 是一种光线求交技术
1. 在寻找物体交点时，**光线追踪 (Ray Tracing)** 通过求解解析几何方程，一步到位地**精确计算**出光线与物体（如三角面片）的交点。
    1. 构建 BVH, 八叉树优化
2. 而**光线步进 (Ray Marching)** 则是通过反复询问一个距离函数（如SDF），以**小步迭代、逐步逼近**的方式“行走”到物体表面，它并不直接计算精确交点。
3. 因此，光线追踪非常适合处理由**多边形**定义的传统三维模型，而光线步进则极其擅长渲染由**数学函数**（SDF）定义的、几何形状无限复杂的对象，如分形和体积云。

## 有哪些加速 RayMarch 的策略？步进过程能优化吗？

- 屏幕半分辩率下进行
- 使用 Hi-Z 来动态选择步长, 跳过空白区域
- 使用 SDF 动态选择步长, 跳过空白区域
- 使用compute shader来进行RayMarch过程。为屏幕上的**每个像素**启动一个独立的**工作项**

## 在移动设备如何实现镜面反射？

- [[平面反射]]
- [[SSR]]
- 反射探针

## 了解光线追踪吗？路径追踪是什么？

- 光线追踪基于蒙特卡洛方法与光路可逆原理，从相机或者光源发射多根光线，并对其进行追踪和计算光照，从而物理的模拟光线在场景中的传播
- 光线追踪有以下这些实现
    - Ray Casting 只计算直接光照
        - 为屏幕上的每个像素发射**一条**主光线。找到光线与场景的第一个交点。
        - 根据该交点的材质颜色和**直接光照**（通过向光源发射阴影光线判断）来确定像素颜色。
        - **然后就结束了**。光线不会反弹或穿透。
    - [[WhittedRayTracing]]
        - 在 RayCasting 的基础上, 加入光与表面的交互
        - 只对光滑表面进行反射和折射光线的计算
        - 对于粗糙表面, 光线停止追踪，直接计算局部光照
        - 只能处理理想化的、镜面一样的反射和折射
    - Stochastic Ray Tracing
        - 使用漫反射和高光反射两种分布来描述表面与光线的相互作用
        - 围绕一个空间中漫反射或高光反射波瓣进行积分计算
        - 为了计算积分方程，引入了蒙特卡洛方法。
    - [[Path Tracing]]
        - Kajiya统一了渲染方程，并推导出了渲染方程的路径表述形式，使得渲染方程由一个递归的结构，变成一个路径函数的积分，即路径追踪。
        - 首先在场景中物体的表面随机产生一些点，然后将这些点和光源以及摄像机链接起来形成一条路径，每个路径就是一个路径函数的随机值。
    - [[双向路径追踪]]
        - 有相当部分的路径组合由于表面间可能被遮挡而形成无效的路径，对最终光照没有任何贡献。
        - 从光源和摄像机两个方向出发，分别经过一定的路径之后，将该两条路径的终点链接起来形成一条完整的路径，这样大大增加了光源的有效贡献。

## 光线追踪和路径追踪的区别？

- 光线追踪是指一个算法大类，通过对光线进行追踪，从而实现某种效果。
- 路径追踪是一种具体的光线追踪方法。

## 怎么计算得到屏幕上某个像素射出去的光线？怎么计算得到屏幕上某个像素射出去的光线？

- 光线的定义需要一个原点和一个方向。
- 对于正交投影: 所有光线的方向都是一样的, 与相机的观察方向相同. 将成像平面的像素坐标转换到世界空间坐标, 即可获得光线的原点
- 对于透视投影. 所有光线的原点是相同的, 即相机位置. 将成像平面像素中心的坐标转换到世界空间, 然后与相机位置相减, 即可获得光线的方向. 
    - 即执行 VP 变换的的逆

## 光栅化和光线追踪的区别？

- 光栅化是通过将图元离散化为屏幕上的点, 形成片元并计算着色, 以及混合从而形成一幅图像
- 光线追踪是指从相机位置向屏幕像素位置发射光线, 找到光线与场景的交点, 递归计算该点对像素颜色的贡献, 从而形成一幅图像

## 介绍一下光线追踪的流程？

- 光线追踪是一大类算法的统称, 实现细节各有不同, 基本的光线追踪流为. 
    - 从相机所在位置, 向屏幕像素网格发射一条光线
    - 找到这条光线和场景图元的第一个交点
    - 向各个光源发射一条射线, 判断光源是否可见, 并对该表面点进行着色
    - 根据交点材质属性选择方向, 再次发射一条光线, 重复 2-4 步, 直到达到终止条件

## 是否了解过开源项目的光追方法？

这个应该是指API之类的。主流的有DirectX 12的DXR，vulkan的光追扩展，以及Nvidia的Optix
