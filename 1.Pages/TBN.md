---
Type: 
aliases: 
tags: 
modifiedDate: 2025/06/25, 22:20:57
---

# TBN

在hlsl中，矩阵float3×3（tbn），是按行存储的? 列主序, **是否行主序还是列主序跟代码无关**, 只要当成按行构建矩阵就行, 只需要记住列主序相对较快就行

即

T

B

N

mul（N，tbn），此时n作为行向量，与tbn进行运算，结果是1行三列，符合认知

mul（tbn，N），n作为列向量，结果是3行一列，正确。

即符合数学运算认知，最后结果是相同的，但是计算时间因为主序可能有所不同

对于 一般的法线贴图，主轴是z，从法线贴图中采样得到的mul（normal，tbn）即可得到右手系下的法线（主轴来到y）

所以你的主轴不在z轴的话，就踩大坑了，可能需要把tbn变成tnb等等，也可能需要转置矩阵

需要给定的切线，一般是x轴，法线也会给出，一般是z轴，所以副切线一般对应y轴，但这无所谓，。重要的是为了保持右手系（），副切线通常由cross（n，t）得到

太对了/😀

主要是看 切线空间的三条轴 对应到世界空间 的结果

第一条轴对应的向量应该在变换矩阵的第一列，他的值为t，同理，第三条轴对应的向量应该在第三列，值为n，最后第二条轴对应的基向量对应第二条轴，值为b

**第一条轴上的主切线对应 $T$（由世界空间计算得到），第二条是 $ B$ ，第三条切线空间的$z$ 轴（宏观上等于世界空间模型的法向量$N$）$N$。所以$B$对应切线空间$y$轴，为保持右手定则，$B= cross(N，T)$即$+y = cross(+z,+x)$**

## 构建

原理: [[基底]]
- **顶点着色器**：传出顶点法线、切线和（有时）副切线到片元着色器
- **片元着色器**：用插值得到的切线和法线重建 TBN 矩阵，并使用该矩阵将采样得到法线贴图的切线空间法线变换到世界空间或视空间
- 即将模型顶点上的法线,切线通过model矩阵转换到世界空间 (当然, 可以选择转换到 viewspace)
- 将世界空间法线和切线送到像素着色器 
- 像素空间使用经过插值的法线和切线重建TBN矩阵
- 使用TBN矩阵乘采样得到的切线空间法线得到世界空间法线?
    - 这里不需要将切线空间法线乘 model 矩阵
