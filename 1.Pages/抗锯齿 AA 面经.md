---
Type:
  - 面经
aliases: 
tags: 
modifiedDate: 2025/06/24, 16:43:10
---

# 抗锯齿 AA 面经

## 抗锯齿算法知道哪些 ？了解哪些抗锯齿方法，分别说一下原理？介绍一下抗锯齿有哪些方法？

### 基于屏幕空间的抗锯齿方法（只对渲染管线输出的样本进行处理）

- [[SSAA]] 超采样方法, 对每个像素计算多个样本的方法. 该方法以更高的分辨率来渲染整个场景, 然后再对相邻像素样本进行滤波 (卷积, 均值) 从而生成一个图像
- [[MSAA]] 多重采样抗锯齿, 每个片元只执行一次片元着色器. 对于 4xMSAA, 每个像素保存四个子样本, 每个子样本有独立的颜色和深度信息. 每个片元根据子样本的覆盖情况, 决定着色位置, 并将着色结果共享给子样本. 基于这个思路的抗锯齿还有 CSAA, EQAA
    - CSAA 将 **颜色样本数和覆盖样本数解耦**, 8x CSAA 实际只有 4 个颜色/深度样本，但有 8 个覆盖样本，用以模拟更丰富的边缘细节。
    - EQAA, 类似 CSAA，同样**分离颜色样本和覆盖样本**，但允许更灵活的控制, 允许开发者/驱动控制颜色样本与覆盖样本的比率
- [[TAA]] 一种通过之前几帧的结果来对当前帧进行优化的抗锯齿技术
    - motion vector 与重投影

### 基于形态学的抗锯齿方法 (一种后处理方法, 针对锯齿出现的位置进行抗锯齿处理)

- [[FXAA]]  快速近似抗锯齿
- [[SMAA]] 亚像素形态学抗锯齿
两种算法都只使用了颜色缓冲，而SMAA的优势在于它还可以访问MSAA的样本。

## 8倍的MSAA，缓冲区大小也要8倍吗？MSAA和延迟渲染不能共存只是带宽和显存的问题吗？

- 是的, 每个子样本都需要维护独立的颜色线性和深度信息
- MSAA 在延迟渲染中实现需要使用 [[MRT]], DX 在 DX9 之前不支持 MRT, 也就无法在延迟渲染中实现 MSAA.
- 此外, 尽管如今支持了 MRT, 4xMSAA 要求 4 倍的颜色和深度, 而 deffered 本身就对显存和带宽有巨大开销, 两者相加, 会带来巨量的显存和带宽开销

## TAA存在哪些问题？如何解决拖影？

[[TAA]] 是一种利用运动向量和重投影利用之前帧的样本信息来对当前帧进行优化的抗锯齿技术, 维护前几帧的颜色缓冲, 运动向量并进行混合
- 拖影 (鬼影, ghosting) 快速移动的物体或场景中新暴露的区域，可能会在其后方留下半透明的“残影”或“拖尾”。
    - 原因
        - 历史帧的数据没有被完美的重投影或及时的被清除
    - 解决方法
        - 只对场景中缓慢移动的物体进行 TAA
        - 限制历史像素颜色的取值范围, 使其不能超过周围 3x3 像素区域的颜色最大值和最小值, 在 YCoCg[^1] 颜色空间内进行 Clamp
- 闪烁 (flickering)
    - 图像中高频细节（如远处的细线、栅栏、草地、树叶、细小纹理图案）在摄像机或物体移动时出现不稳定的、跳动的、或消失/出现的伪影。
    - 原因
        - 每帧的采样点有限，对于小于一个像素的细节，采样可能不够稳定；过度激进的鬼影修复方法也可能加剧闪烁。
    - 解决方案
        - 限制历史像素颜色的取值范围, 使其不能超过周围 3x3 像素区域的颜色最大值和最小值, 在 YCoCg[^1] 颜色空间内进行 Clamp
        - 优化采样序列, 使用更均匀的采样模式, 如 halton 序列, 确保样本在空间和时间上分布均匀，减少重复模式和采样点聚簇。

## 讲述光栅化里的MSAA和SSAA的区别？MSAA和SSAA区别？

- SSAA会对每个片元的子样本都进行着色，然后再对这些样本的着色结果进行过滤 (平均)，降采样到低分辨率上。
- MSAA 对每个片元只进行一次着色, 但会保存每个子样本位置的颜色信息和深度信息. 

## MSAA 的原理和实现细节？为什么要用 MSAA？

MSAA 多重采样抗锯齿
[[MSAA]] 相比 SSAA 只对每个片元进行一次着色计算, 但也像 SSAA 一样保存每个子样本位置的颜色和深度信息.
具体的:
- 在光栅化阶段, 对每个像素采多个采样点, 每个子样本独立判断是否被三角形覆盖, 记录深度值 (EarlyZ)
- 在像素着色阶段, 每个片元根据子样本覆盖情况, 调整着色位置, **每个[[片元]]只进行一次着色器调用**, 无论有几个子样本
    - 如果子样本覆盖了像素中心, 则在中心计算着色结果
- 合并阶段, 根据子样本的覆盖情况，将对应的颜色复制到子样本上。
- 输出阶段, 会将所有子样本的颜色结果平均
MSAA 相比 SSAA 最大的优势就是对于每个片元只进行一次着色计算, 大大降低了计算成本

## 简要介绍TAA的原理？以及常见优化手段？

[[TAA]]

[^1]: YCoCg 空间的优势：分离亮度和色度. 
    - **Y (Luma)**：**亮度**分量。它代表了颜色的明暗程度，基本上就是这个颜色的灰度图。
    - **Co 和 Cg (Chroma)**：**色度**分量。它们代表了颜色与灰色（无彩色）的差异，即“颜色本身是什么”（偏橙色还是偏绿色）。
