---
Type:
  - Page
aliases: 
tags: 
modifiedDate: 星期六, 五月 31日 2025, 1:30:03 下午
---

## 共享虚表

- **差分虚表 (Differential Vtables)**：不为每个子类生成一个完整的虚表，而是存储与父类虚表**不同的部分（即覆写的方法）**。
- **共享基类虚表**：如果派生类没有覆写任何虚函数，它甚至可以直接指向父类的虚表。
- **间接引用**：对象中的 `vptr` 不直接指向函数指针数组，而是指向一个更小的结构，这个结构包含了对基类虚表的引用以及一个小的“覆写表”。当查找虚函数时，先查覆写表，如果没找到，再到基类虚表查找。

### 缺点

虚函数调用会增加一次或多次**间接寻址**的开销（性能下降）。

## 全局虚表

虚表中不存储完整的函数指针，而是存储一个**函数索引**或**函数ID**。
在运行时，通过这个索引到一个**全局的函数映射表**中查找真正的函数地址。
覆写时，派生类只需替换或新增索引。

### 缺点

多一次寻址
