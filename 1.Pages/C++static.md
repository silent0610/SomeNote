---
Type:
aliases: 
tags: 
modifiedDate: 2025/06/18, 18:51:12
---

# C++static

## 定义

C++ 关键字

## 作用

static 作用：控制变存储方式和可见性。

### 修饰局部变量

**修改存储方式+可见性**
- 局部变量在栈上分配, 退出语句块时自动销毁
- 使用 static 修饰后, 存储在 [[C++内存区域]]中的静态数据区, 其生命周期延续到整个程序生命周期
    - 在第一次进入时初始化
- 作用域仍在当前语句块中
- 函数可以返回静态变量的引用, 实现[[单例模式]]

### 修饰全局变量

**修改可见性**
- 对于一个非static的全局变量，对本文件（编译单元）可见，对同工程中的其他源文件也可见（添加extern即可）。
- 对于一个static的全局变量，仅仅对本文件（编译单元）可见。

### 修饰全局函数

**修改可见性**
与static的全局变量类似，从工程可见变为本文件可见。

### 修饰类中的成员变量

- 该变量被整个类拥有, 存储空间内只存在一个副本, 存储在全局静态变量区
- static 的成员变量在 C++17 前必须在另外初始化,在类内只是声明
    - C++17 引入的 [[C++17新特性#^597e40|inline static]] 解决了这一问题, 使得静态成员变量能在类内初始化, 简化了头文件和源文件的管理

### 修饰类的成员函数

**修改存储方式**
- 该成员函数被整个类所拥有，**该函数不接收this指针**，因此**只能访问类内的static成员变量**，无法访问非static的成员变量。
- static 成员函数不能被 virtual 修饰. 原因:
    - 虚函数的调用是通过虚表指针实现的, 没有 this 就意味着无法访问虚表指针. 
    - 再者, 从语义上, 虚函数的调用依赖于对象, static 函数不依赖对象. 

## 不能是 Static 的

- 构造函数
    - 构造函数的目的是创建对象，而 `static` 函数与对象无关，编译器无法通过 `static` 函数构造对象。
- 析构函数（Destructor）
    - 析构函数用于销毁对象，同样依赖 `this`，也不能是 `static`。
- 虚函数
    - 虚函数依赖于虚函数表（vtable）来实现多态调用，而静态函数属于类本身，不参与虚表。没有 this 指针, 就找不到虚表指针, 进而找不到虚表
- 拷贝构造函数、移动构造函数、赋值运算符等特殊成员函数
    - 它们操作的是类的实例，必须有 `this` 指针，不能是静态的。
- 依赖于 this 指针的运算符成员函数
