---
Type:
  - Page
aliases:
  - std::shared_ptr
  - 共享指针
tags: 
modifiedDate: 星期六, 五月 31日 2025, 1:26:19 下午
---

## 定义

提供共享所有权 ，允许多个 `shared_ptr` 指向同一个对象。

## 实现细节

- 内部维护着一个控制块
    - 强引用计数: 即多少个 `shared_ptr` 指向同一对象
        - 当一个新的 `shared_ptr` 指向该对象时（例如通过拷贝构造或拷贝赋值另一个指向该对象的 `shared_ptr`），强引用计数会加 1。
        - 当一个 `shared_ptr` 被销毁（例如离开作用域）或者被重新赋值指向其他对象时，它之前指向对象的强引用计数会减 1。
    - 弱引用计数: 有多少个 [weak\_ptr](weak_ptr.md) 指向该对象

### 多线程安全性

> 需要注意的是 `shared_ptr` 管理对象的生命周期是线程安全的，但对象内部数据的并发访问不是。

个人理解就是: 一定可以获得对象, 以及得知对象什么时候被销毁. 但是如果要读写对象内部数据, 某个指针的修改不会同步反应到其它指针
需要使用临界区, 互斥量保护对象数据

## 作用

- 当一个智能指针在销毁时, 其强引用计数**降为 0** ，意味着不再有任何 `shared_ptr` 指向该对象。此时，会对该保存的指针进行 Delete**自动删除**，其占用的内存会被释放。
- **自动内存管理：** 显著减少内存泄漏的风险。
- **易于共享：** 方便地在代码的不同部分共享对象的所有权。

## 缺点

- [智能指针循环引用](智能指针循环引用.md)
