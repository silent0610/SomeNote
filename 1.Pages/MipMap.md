---
Type:
aliases: 
tags: 
modifiedDate: 2025/06/25, 21:25:25
---

# MipMap

## 定义

**指的是一系列预先计算好的、分辨率从高到低依次递减的纹理图像集合**。这一整个集合被视为一个“Mipmap贴图”，被打包在一起，作为一个单独的纹理单元使用。
在进行采样的时候，根据梯度信息来计算所需要采样的mipmap层级，然后进行三线性插值。可以提高缓存命中率。

## 为了解决什么问题

### 渲染质量（画面闪烁与摩尔纹）

远处物体
远处或侧看物体表面出现**闪烁、锯齿、噪点和不自然的摩尔纹（Moiré Pattern）**。这种现象本质上是一种“像素采样失真”（Aliasing）。

### 渲染性能（缓存与带宽浪费）

当GPU渲染远处物体时，它仍然试图从巨大的、高分辨率的原始贴图中读取数据。这会导致GPU的**纹理缓存（Texture Cache）效率极低。因为渲染相邻像素所需的数据在原始大图上可能离得很远，导致缓存频繁“未命中”（Cache Miss），GPU不得不反复从更慢的显存（VRAM）中抓取数据。 这会严重浪费内存带宽**，并**降低渲染速度**，造成性能瓶颈。

## 根本原因

由于[[奈奎斯特定理]]极限, 采样率必须要在原始信号的频率两倍以上才能完美还原. 由于远处物体的采样率较低, 因此需要适当降低原始信号的最大频率. 
- 通过对图像进行降采样, 过滤了信号中的高频信息, 降低了最大频率, 从而符合奈奎斯特极限

> **纹理能够表示的最高频率为 1/2**, 假设我们的纹理是一个极端情况，例如，它是由一系列紧密排列的黑白相间的条纹组成，每个黑条纹和白条纹各占一个纹素。那么，这个纹理的最高空间频率就是 1 周期 / 2 纹素. **再高, 纹理就区分不出来了.**

- **根据每个屏幕像素采样了多大范围的纹理, 判断采样频率**. 理想情况是 1, 符合奈奎斯特极限
- **当一个高频纹理被渲染到远处时，它在屏幕上只占很小的空间。相当于用很低的屏幕像素采样率，去试图表现一个高频的纹理信号。这严重违反了奈奎斯特采样定理，其结果就是产生严重的走样**

## 生成?

- 如果纹理参数和最终的着色颜色之间**具有线性关系**，则可以直接使用每 $2 \times 2$ 纹素的平均值来作为下一级 mipmap 的纹素值。
- 如果纹理参数和最终的着色颜色之间具有非线性关系，则需要使用特殊的滤波方法，常见的非线性参数就是法线，因此对于法线贴图，需要特殊处理，一般会将着色方程的输入参数作为一个整体来进行过滤，而不适单独对法线贴图进行过滤。Toksvig 使用了一种基于法线长度来修改 NDF 粗糙度参数的方法，并使用修正后的粗糙度参数来重新计算 BRDF，从而对过滤后法线的扩散效果进行近似。
- 对于在非线性颜色空间中编码的纹理（例如大多数的彩色纹理），会首先将其转到到线性空间中，完成 mipmap 的生成和过滤之后，然后将最终的结果转换回 sRGB 颜色空间中并进行存储。
