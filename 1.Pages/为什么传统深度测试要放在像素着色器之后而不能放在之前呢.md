---
Type:
  - Page
aliases: 
tags: 
modifiedDate: 星期六, 五月 31日 2025, 1:28:42 下午
---
- **像素着色器可能修改深度值**：像素着色器可以通过 `gl_FragDepth` (OpenGL/GLSL) 或 `SV_Depth` (DirectX/HLSL) 等机制**写入或修改片段的深度值**。如果像素着色器在深度测试之前执行，并且它修改了深度值，那么提前的深度测试结果就会失效。
- **像素着色器可能执行 `discard` 操作**：像素着色器内部可以根据某些条件（如透明度、剪裁贴图等）**丢弃 (discard)** 片段
    - 如果提前进行了深度测试, 那么通过 EarlyZ 的片元**已经修改了 Zbuffer**,
    - 如果这时在像素着色器中 `discard` 这个片元, 那深度缓冲**理应不该被修改**, **可是它又已经被修改了**, 就会出现冲突
- 深度测试是一个原子操作
    - 在进行这个操作时，不能有其他线程或核心同时修改深度缓冲的同一个位置，以避免数据竞态和不一致性。
    - 如果进行 [Early-Z](Early-Z.md) 那就要两个硬件单元，一个放在前面负责 Compare-Discard，一个放在后面负责 Compare-Exchange
    - 而ROP (Raster Operations) 是要负责**保序输出**的,[^1] 从而导致:
        - 前一个 primitive 的 Compare-Exchange 没有完成之前, 
        - 后一个 primitive 的 Compare-Discard 就必须 stall (保序输出)
    - 从而
        - 略微降低并行性
        - **电路复杂性**：为了处理这种复杂的依赖关系,GPU 需要设计更复杂的控制逻辑和硬件单元
            - 而早期很可能**硬件资源受限**, 且**设计水平不足**

[^1]: 像素的写入是按原始绘制顺序 (draw order)
