---
Type:
aliases: 
tags: 
modifiedDate: 2025/06/18, 20:16:01
---

# C++volatile

## 定义

`volatile` 是 C/C++ 中的一个关键字，用于告诉编译器：**这个变量的值可能随时发生改变**，即使程序中没有明显地修改它。

## 作用

- 每次访问都必须直接访问内存，**禁止优化访问次数**。
- 在遇到这个关键字声明的变量时，编译器**对访问该变量的代码就不再进行优化**，从而可以提供对特殊地址的稳定访问。当要求使用 volatile 声明的变量的值的时候，系统总是重新从它所在的内存读取数据，即使它前面的指令刚刚从该处读取过数据。而且读取的数据立刻被保存。
举例：当两个线程都会读写一个变量的时候，使用该关键字，可以防止编译期优化，将变量放入寄存器中。如果变量被放入寄存器，那么两个线程一个使用寄存器中的，一个使用内存中的，会造成程序的执行错误。

## 应用

1. 中断服务程序中修改的、供其它程序检测的变量需要加volatile；
2. 多任务环境下各任务间共享的变量应该加volatile；
3. 存储器映射的硬件寄存器通常也要加volatile说明，因为每次对它的读写都可能有不同意义；

## 总结

1. 易变性：在遇到volatile变量的时候，不会直接使用可能存储在寄存器中的volatile变量中的内容来优化, 而是会**重新从内存中**进行读取。
2. **不可优化性**：volatile告诉编译器，不要对该变量进行激进的优化，保证稳定的执行和访问。
3. 顺序性：保证volatile变量之间的顺序性，编译器不会进行乱序优化。
