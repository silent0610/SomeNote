---
Type:
  - Page
aliases:
  - 转型
tags: 
modifiedDate: 2025/06/17, 15:58:09
---

# C++Cast

## 定义

在 C++ 编程中，**转型（Casting）**是指将一个数据类型的值或对象引用**转换为**另一种数据类型。你可以把它想象成给一个变量换一套“眼镜”或者换一个“身份”，让它在代码中以不同的类型被看待和操作。

## 分类

### C Style 强制类型转换

语法：`(目标类型)表达式` 例子：`(int)myFloatValue` 特点：这种方式比较粗暴，它会尝试执行一个转换，但不会提供太多的类型安全检查。它可能隐藏错误，***并且其行为可能等同于 C++ 提供的多种特殊 `cast` 中的任何一种***，导致代码意图不明确。因此，在 C++ 中**不推荐**使用 C 风格的转换。

### C++ Style

- `static_cast`：用于安全的编译时类型转换，比如基本类型转换、向上转型、以及向下转型（但需要程序员自行保证安全，无运行时检查）。
- `dynamic_cast`：用于安全的运行时向下转型，它会进行运行时类型检查，转换失败会返回空指针或抛出异常。只能用于多态类。
- `const_cast`：专门用于添加或移除变量的 `const` 或 `volatile` 属性。
- `reinterpret_cast`：用于进行低级别、位模式的类型转换，通常用于不相关的指针类型之间或指针与整数之间，极不安全。

#### [[C++static_cast]]

#### dynamic_cast

- **用途**： 只能用于多态类
    - 专门用于**安全的向下转型（downcasting）**，即从基类指针/引用转换为派生类指针/引用。
    - 只能用于**多态类**（即至少有一个虚函数的类）。
    - 可以用于**交叉转型（cross-casting）**，即在多继承层次结构中，将一个基类指针/引用转换为另一个不相关的基类子对象的指针/引用（如果它们都派生自同一个虚基类）。
- **安全性**：
    - **运行时类型检查**：`dynamic_cast` 会在运行时执行类型检查，以确定目标类型是否合法。
    - **指针版本**：如果转换失败（即基类指针实际没有指向目标派生类对象），它会返回 `nullptr`。
    - **引用版本**：如果转换失败，它会抛出 `std::bad_cast` 异常。
- **语法**： `dynamic_cast<type-id>(表达式)`
==type-id必须是类指针，类引⽤或 void*==

##### 怎么进行向上转型?

因为向上转型是一个**始终安全**的操作（一个“派生类”对象 _is-a_ “基类”对象的关系是确定的），编译器知道这一点，所以**不需要** `dynamic_cast` 去进行任何运行时的动态检查。编译器会把 `dynamic_cast` 的向上转型操作**优化得和 `static_cast` 一模一样**。

#### const_cast

- **用途**：
    - **移除（或添加）`const` 属性**：它主要用于在指针或引用上添加或移除 `const` 或 `volatile` 属性。
    - 它是**唯一**能移除 `const` 属性的 C++ `cast`。
- **安全性**：
    - **危险**：使用 `const_cast` 来移除一个原本就是 `const` 变量的 `const` 属性，并尝试修改它，会导致**未定义行为**。
    - **安全使用场景**：通常用于需要将 `const` 对象传递给只接受非 `const` 参数的旧 C API，或者在成员函数中修改 `mutable` 成员时。它只是改变了**指针/引用的视图**，而不是被指向对象的实际 `const` 性。
- **语法**： `const_cast<目标类型>(表达式)`

#### reinterpret_cast

- **用途**：
    - 执行**底层、位模式**的类型转换。它将一个类型的数据的位模式重新解释为另一种类型的数据。
    - 例如，将一个指针转换为一个整数，或者将一个不相关的指针类型转换为另一个不相关的指针类型。
    - 通常用于低级编程、硬件交互或与 C 语言库进行接口。
- **安全性**：
    - **极度危险**：`reinterpret_cast` 不会执行任何类型检查，不保证可移植性，而且很容易导致未定义行为。它只改变了编译器的视角，不改变数据本身的内存布局。
    - 使用 `reinterpret_cast` 后的结果通常是平台相关的。
- **语法**： `reinterpret_cast<目标类型>(表达式)`
