---
Type:
aliases: 
tags: 
modifiedDate: 2025/06/11, 15:24:43
---

# SDFDDGI

## SDFDDGI 方法概述

SDFDDGI（Signed Distance Field Dynamic Diffuse Global Illumination）是一种利用符号距离场（SDF）在实时渲染中实现动态漫反射全局光照的新方法。 它的主要目标是克服现有实时 GI 方法在处理动态几何体、动态光照以及光照泄露（light leakage）和降噪方面的局限性，同时无需任何预计算。

该方法的核心思想是：

> [!note] SDF  表示
> 我目前的方法是使用体素, 或者说八叉树, 天然适合解析表达 (立方体), 以后可以对比一下直接使用立方体存储生成 SDF 的结果 #TODO [[DepthSDF]]

1. **构建紧凑的 SDF 场景表示：**
    - 传统 SDF 通常存储在离散体素中，需要大量存储空间且难以处理动态变化。
    - SDFDDGI 的方法是**将场景近似为一组简单的基本几何体[^1]（如立方体、球体、平面、圆柱体等）**，并计算它们的 SDF 值。 这种表示方式更加紧凑，存储成本低（例如，Sponza 场景只需 4KB），并且便于实时计算和动态变化。
    - 为了简化，目前的实现是**手动创建**这些 SDF 基本体，但作者指出未来研究可以探索自动近似模型的方法。
    - 这些 SDF 基本体根据摄像机位置进行剔除，并按距离聚类，以加速 SDF 查询。
2. **基于 SDF 的探针位置调整和选择：**[[SDFDDGI 的探针定位]]
    - 该方法使用**探针 (probes)** 来离散采样空间域中的辐照度函数。 每个探针存储其位置周围一个方向球体上的辐照度。
    - 探针最初放置在一个**均匀网格**中（在摄像机周围创建一个空间排列的探针体积）。
    - 关键创新在于，SDFDDGI 会利用其紧凑的 SDF 表示来**调整探针的初始位置**。
        - 如果探针最初的位置太靠近物体甚至在物体内部（SDF 值小于某个阈值），这将对采样质量产生负面影响，并导致漏光。
        - 此时，算法会查询 SDF 的梯度，并使用**梯度下降法**来找到一个可接受的、远离物体的采样点。 这确保了探针不会落入物体内部或太靠近表面，从而有效**防止了漏光问题**。
    - 该方法还决定**哪些探针需要更新**，并根据探针与摄像机的距离和方向分配不同的权重，从而在不同帧之间分配更新。
        
    - 整个探针定位过程非常快速，**不需要烘焙**，也**无需人工干预**，能够快速准确地响应场景变化。
        
3. **高效的探针辐照度更新：**
    
    - 使用计算着色器（compute shaders）在每个选定的探针处采样方向球体上的辐射度，以计算辐照度。
        
    - 在采样前，SDF 基本体和聚类结构会被加载到 L1 缓存中，以加速频繁的 SDF 查询。
        
    - 进行 SDF 球体追踪（sphere tracing）以获取光线与场景的交点，并利用反射阴影贴图（RSM）获取通量。 SDF 球体追踪还利用 SDF 的 Lipschitz 常数特性来优化查询性能。
        
    - 通过重用上一帧的探针 GI 数据，实现了**多重弹射全局光照**。
        
4. **像素级 GI 着色和 Contact GI 细节增强：**
    
    - **像素级探针可见性测试：** 为了彻底消除漏光，SDFDDGI 采用了**像素级探针可见性测试**，而不是像 RTXGI 那样使用低分辨率的深度缓冲区和 VSM。 这个测试是利用 SDF 阴影追踪（SDF shadow trace）完成的，可以自然地产生柔和的间接阴影和过渡效果。
        
    - **优化可见性测试：** 虽然像素级测试计算成本高，但论文通过有效的降采样策略（包括 min/max 棋盘格降采样、帧间像素选择和重复剔除）大大减少了计算量。
        
    - **Contact GI：** 为了弥补简化 SDF 几何和辐照度函数离散化造成的细节损失，SDFDDGI 引入了 **Contact GI**（受基于地平线的环境光遮蔽 - GTAO 启发）。
        
        - Contact GI 在计算环境光遮蔽时，会同时计算入射辐照度，从而在不产生过度遮蔽的情况下增强漫反射 GI 的细节。
            
        - 最终的着色结果是探针插值结果与屏幕空间 Contact GI 结果的加权和。

## 主要贡献

该论文的贡献总结如下：

- 一种新颖的**场景依赖型探针定位方法**，基于 SDF，能够捕获辐照度函数的空间分布。
    
- 一个**防止漏光的新解决方案**，通过像素级可见性测试处理了先前方法中出现的伪影。
    
- 一个**高效的屏幕空间细化方法（Contact GI）**，用于增强基于探针的 GI 的细节和质量。

## 性能与优势

- SDFDDGI 能够在 **不进行任何预计算** 的情况下，高效地计算**动态几何体和动态光照**的实时漫反射全局光照，并支持**多重弹射光照**。
- 它不依赖于特定的硬件（**硬件无关**），能够管理大型开放场景和室内高细节场景。
- 相较于离线路径追踪器，SDFDDGI 仅需额外约 1.3 毫秒的时间即可计算间接全局光照，而离线追踪器需要超过 2 分钟。
- 该方法在多个 GPU 上进行了性能测试，并与 RTXGI、SSGI、Ray Tracing GI 和 VXGI 等其他实时 GI 方法进行了对比，显示出其在保持相同或更优质量的同时，达到了最佳性能。

## 局限与未来工作

- 目前的 SDF 表示需要部分手动创建，对于大型复杂场景可能劳动密集。 未来研究可以探索自动近似模型的方法。
- 当前研究主要关注动态漫反射 GI，对于镜面反射 GI 仍需依赖其他方法（如 SSR 或光线追踪）。
- 探针体积的密度是固定的，未来可以实现自适应采样，使算法更适用于不同尺度的场景。
- 可以通过重要性采样来优化探针光线生成，进一步稳定全局光照。

[^1]: 简单的几何体的 SDF 可以解析表示, 所以只用存储空间位置+大小+几何体类型
