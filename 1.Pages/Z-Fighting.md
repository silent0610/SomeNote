---
Type: 
aliases:
  - 深度冲突
  - Z缓冲冲突
tags: 
modifiedDate: 2025/06/19, 15:33:06
---

# Z-Fighting

## 定义

是一种渲染错误，当两个或多个多边形在三维空间中距离非常近或者完全共面（Coplanar）时，由于计算机深度缓冲（Depth Buffer 或 Z-Buffer）的精度限制，GPU 无法精确地判断出哪个多边形应该在前面，哪个应该在后面。

> 在渲染每一帧时，这两个多边形的像素会交错、随机地覆盖对方，从而在物体表面产生一种**闪烁、条纹状或棋盘状的混乱图案**。这种闪烁会随着摄像机的轻微移动或旋转而变得更加明显和无规律，严重影响画面的稳定性和真实感。

## 原因

- 深度缓冲的浮点数精度有限
    - 浮点数接近 0 时的精度更高
- 深度缓冲中的 z 是非线性分布的, 绝大部分物体的深度分布在 接近 1 的地方
    - 这是因为投影矩阵是非线性的, 它会将**绝大部分的精度分配给靠近摄像机近裁剪平面 (Near Clipping Plane) 的物体**，而离摄像机很远、靠近远裁剪平面 (Far Clipping Plane) 的物体只能共享剩下的一小部分精度。
    - 基于第一点，如果你将摄像机的**近裁剪平面设置得太小**（例如 `0.001`），同时将**远裁剪平面设置得太大**（例如 `100000`），这个比值就会非常悬殊。
- 共面或近乎共面的几何体 (Coplanar/Near-Coplanar Geometry)
- 对数z-buffer：可以使用深度值的对数来提高阴影图（shadow maps）的精度。当GPU不支持浮点类型的z-buffer，且所渲染的场景深度很大的时候，这是一个很好的替代方法。
- 视锥体深度划分：这个方法的核心思路是将大的视锥体在深度方向上划分成若干个不重叠的小视锥体，这些小视锥体结合在一起就是大视锥体。

## 解决方式

- 调整摄像机裁剪平面
    - 让近裁剪平面尽可能远，远裁剪平面尽可能近。
- 使用更高精度的深度缓冲
- 反向 zbuffer [[Inversed-Z]]
- 手动分离错误的过于接近的物体
