---
Type:
  - Page
aliases:
  - importance sampling
  - IS
tags: 
Status: 
modifiedDate: 星期四, 六月 5日 2025, 7:44:23 晚上
---

# 重要性采样

## 目的

减少样本数量，在一定的抽样数量基础上来增加准确度，减少方差

## 细节

根据[蒙特卡洛积分](蒙特卡洛积分.md)
我们有

$$
\int f ( x ) \, d x \approx\frac{1} {N} \sum_{i=1}^{N} \frac{f ( x_{i} )} {p ( x_{i} )}
$$

> 在这里, 其实可以通过数学证明, 当 p(x) 越接近 f(x) 的形状时, 积分误差就越小（方差越低）

于是就有了
**重要性采样的核心思想**：让采样概率密度 p(x) 靠近被积函数的形状。

回顾[渲染方程](渲染方程.md), 我们有,

$$
L_{o} ( x, \omega_{o} )=\int_{\Omega} f_{r} ( x, \omega_{i}, \omega_{o} ) \cdot L_{i} ( x, \omega_{i} ) \cdot( \omega_{i} \cdot n ) \, d \omega_{i}
$$

$f_{r} ( x, \omega_{i}, \omega_{o} ) \cdot L_{i} ( x, \omega_{i} ) \cdot( \omega_{i} \cdot n )$ 这就是被积分的 $f(x)$ ==(注意, 这里我们是可以计算出 f (x) 的值的==
这个 fx 是三维的, 无法通过逆 CDF 的方式得到积分的解析解
- 接下来要做的就很明确了, 贯彻重要性采样的思想, **去找到和 f (x) 的形状最接近的 p (x)**, 而且**要求p(x​) 的逆 CDF 容易计算**,这样我们才能从 p(x​) 中有效地生成随机样本。
    - **逆 CDF 的作用**?
        - 输入 0 到 1 的随机数, 得到符合 p (x) 分布的样本
        - 例如 输入 0 ,得到 0, 输入 0.1, 得到 4, 输入 0.9 得到 6, 输入 1, 得到 10. 
        - 所以, 我们就能以 0.8 的概率, 生成 4 到 6 区间的样本
- 需要知道的是, 这三个函数中, 计算最复杂的是光照 Li, 然后是 brdf, 最后是 wi\*n
    - 能直接用 f (x) 吗?
        - 不能, 你确实知道 f (x) 的值, 但你没法用它去得到一个分布 (得不到 Li 的分布), 进而从这个分布中获取样本
    - 通常可以用 $( \omega_{i} \cdot n )$ 的分布, 即**余弦加权的半球采样**

### 扩展

注意, 我们肯定想要找到一个十分接近 fx 的 px, 但是这样的 p (x) **没法直接得到**. 
于是, 用**另一个简单的分布**, 假如是 q (x), 使用 q (x)**多采样一些点**, 经过一些操作, 近似的去**模拟 p (x) 分布**
这就是[重要性重采样](重要性重采样.md)
