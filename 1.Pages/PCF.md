---
Type:
  - Page
aliases:
  - 百分比接近滤波
  - Percentage-Closer Filtering
tags: 
modifiedDate: 星期二, 六月 3日 2025, 10:28:11 晚上
---

## 定义

- 对 [Shadow Map](Shadow%20Map.md) 的扩展, 目的是实现伪[软阴影](软阴影.md)。
- 通过对附近的接收物位置进行采样来计算光照百分比，从而模拟软阴影效果。

## 实现细节

**原理**：PCF 是最基础也是最常用的软阴影技术。它不直接模糊深度图。相反，对于主场景中的每个被着色像素点：
1. 将该像素点投影到光源空间，得到其光源空间的深度 `P_depth`。
2. 在 Shadow Map 中，不只采样一个深度值，而是在 `P_depth` 投影到的 Shadow Map 坐标周围**采样多个深度值**（例如，使用 2x2, 3x3, 5x5 的采样核）。
3. 对**每个采样的深度值**，独立地执行标准的**二元可见性测试**（`P_depth > SM_sample_depth + bias`，如果为真则返回 0，否则返回 1）。[^1]
4. 将所有采样点的二元可见性结果**平均起来**。

## 优点

- **概念简单，易于实现**。
- **抗锯齿效果**：有效减少了阴影边缘的锯齿（Aliasing）。
- **兼容性好**：依赖于标准的纹理采样和比较操作，几乎所有现代 GPU 都支持。
- **稳健性**：相对于 VSM 等技术，PCF 不容易出现光线渗漏 (Light Bleeding) 等严重伪影。

## 问题

- **性能开销与采样数成正比**：采样点越多，阴影边缘越平滑，但性能开销也越大。
- **半影大小固定**：产生的半影宽度是固定的，不随遮挡物与接收面距离的变化而变化[^2]，缺乏真实的**接触硬化 (Contact Hardening)** 效果。
- **可能出现采样模式可见性**：在采样数不足时，阴影边缘可能出现块状或采样模式的伪影。

[^1]: 为 0 即在阴影中
[^2]: 不影响采样区域大小
