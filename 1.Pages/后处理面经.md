---
Type:
aliases: 
tags: 
modifiedDate: 2025/06/27, 14:55:32
---

# 后处理面经

## 景深效果的原理？

1. 按照距离相机位置的远近 (深度) 将空间划分为近距离, 焦点, 远距离. 对不同范围区域应用不同的模糊处理
2. 弥散圆方法: 像素的深度信息定义了一个弥散圆, 根据弥散圆的大小, 对像素进行不同程度的模糊.

## 什么是色调映射？了解哪些色调映射算法？

[[色调映射|Tone Mapping]]
色调映射指将场景的高动态范围 (HDR) 的 Radiance 值映射为显示器能够显示的低动态范围 (HDR) 内的技术
- Reinhard 色调映射 最早、最简单的一种全局色调映射算子
    - 效果非常**柔和**，对比度较低    
    - 能很好地保留中间调的细节。
    - **缺点**是当场景亮度非常高时，亮部容易**丢失色彩信息，趋向于变成纯白色**，即所谓的“过饱和后变白”（desaturate to white）。
- ACES 美国电影艺术与科学学院
    - **对比度非常高**，暗部会更深邃，亮部则有很好的过渡，整体画面“通透”且富有冲击力。
    - **色彩非常生动**，与Reinhard相比，它能更好地保持高光区域的色彩。
    - 风格非常独特，具有标志性的“电影感”。
- Filmic 由《神秘海域2》的技术美术 John Hable 推广而闻名
    - **高光部分过渡非常柔和**，能够保留更多的亮部细节和色彩，看起来不那么“刺眼”。
    - **对比度适中**，色彩饱和度保持得很好，整体画面观感非常自然和舒服。
    - 提供了多个参数（A, B, C, D, E, F）来精细调整曲线的形状，艺术控制力强。

## 了解哪些后处理方法？

常见的后处理方法及效果包括：

1. 泛光（Bloom） 模拟摄像机镜头或人眼在观看极亮物体时，光线因散射而溢出，在物体周围形成的柔和、模糊的光晕效果，用以增强画面的真实感和氛围感。
2. 景深（Depth Of Field） 模仿相机聚焦的特性，使焦点处的物体清晰，而焦平面之前或之后的景物则变得模糊，以此来引导观众视线并营造出电影般的质感。
3. 镜头光晕（Lens Flare） 模拟强光（如太阳）直射相机镜头时，光线在镜片组内部多次反射和折射而产生的星芒、光斑或光环等视觉瑕疵，用以增加画面的真实性和戏剧性。
4. 运动模糊（motion blur） 模仿相机在有限曝光时间内，快速移动的物体或快速转动的镜头在感光元件上留下的模糊轨迹，以增强画面的速度感和运动的流畅度。
5. 色彩分级（Color Grading） 在图像渲染的最后阶段，通过统一调整画面的整体色调、对比度和饱和度等参数，来营造特定的艺术风格、情绪或氛围（例如，战争电影的褪色感、科幻电影的蓝绿色调）。
6. 暗角（Vigentte） 模拟真实相机镜头因边缘透光率不足而导致的画面四周比中心暗的“渐晕”效果，用以将观众的视线含蓄地引导至画面中央。
7. 色差（Chromatic Aberration） 模仿廉价或广角相机镜头因色散现象，未能在同一点聚焦所有颜色的光，而在物体轮廓边缘（特别是高对比度区域）产生的彩色（通常是红/绿/蓝）条纹瑕疵，常用于营造复古、科幻或迷幻感。
8. 自动曝光（Auto Exposure） 模拟人眼或相机自动适应不同光照环境的过程，当画面从暗处移动到亮处时会短暂“过曝”然后变暗（反之亦然），以此来动态调节画面的整体亮度，使其更接近真实世界的人眼观感。

## 高斯模糊的实现？

### 传统两 Pass

使用高斯滤波核，使用两个独立的一维滤波操作来代替一次二维滤波操作。
- 两遍全屏绘制，独立计算
- 每个像素都从全局显存多次采样

### Compute Shader

- 每个线程组分块处理，协同加载
- 先集中从全局显存加载到高速共享内存 (每个线程组 SM 之间共享)，再从共享内存计算, 相比直接从显存读取更快

## Bloom 的实现？实现过 Bloom 吗？是怎么实现的？

[[Bloom]] 模拟摄像机镜头或人眼在观看极亮物体时，光线因散射而溢出，在物体周围形成的柔和、模糊的光晕效果，用以增强画面的真实感和氛围感。
- 实现
    - 提取画面高亮部分, 使用[[灰度亮度值]]计算出 RGB 值得亮度
    - 进行降采样, 从 1/2 逐步到 1/4,1/8
    - 对每一级进行两 pass 的高斯模糊操作
    - 上采样的同时逐级混合 (上采样并相加)
    - 与初始画面相加, 即可得到 Bloom 效果

## 为何在 Bloom 时候要采样多级 mipmap？不这么做会有什么结果？

主要出于两方面的考虑
- 性能 **最主要的**: 在低分辨率纹理上进行小尺度的模糊, 等价于高分辨率上大尺度的模糊. 但是在低分辨率纹理上进行模糊的开销远小于高分辨率大尺度模糊
- 质量: Bloom 效果应该是从亮点内向外逐渐变暗, 变模糊, 平滑过渡. 
    - 对较高分辨率的进行模糊, 能得到靠近光源的, 较明亮的, 返回较小的辉光
    - 对较低分辨率的进行模糊, 能得到范围较大, 弥散的, 较暗的辉光
    - 最后，将这些不同级别、不同范围的辉光结果**逐级放大并叠加（混合）**在一起，就形成了一个层次感丰富、从内到外平滑衰减的高质量辉光效果。这种层次感是单一模糊无法实现的。

---

假如, 为了质量, 在全分辨率上进行大范围的模糊, 帧率暴跌,
为了性能，只做小半径模糊 **辉光效果差，完全不真实**

## 知道伽马矫正吗？Gamma 矫正? 说说何时切换到伽马空间？

[[伽马校正]]
在计算光照时, 一般是在线性空间计算的. 然后通过 gamma 校正输出到屏幕缓冲区中. 由于人眼对于亮度的感知是非线性的, 显示缓冲区中的值和实际输出的发光强度存在一定映射关系, 这个映射函数被称为光电转换函数.
- 光电转换函数通常近似为 2.2 次方, 如果不理会这种变化, 会有不符合我们预期的结果. 
- 比如, 1 的亮度应该比 0.5 亮一倍, 但在 2.2 次方后, 并不是一倍, 而是接近四倍
- 为了抵消光电转换函数的影响, 我们需要对颜色进行光电转换的逆变换. 即 gamma 校正. 
- 一个近似的方法是, 将输出的颜色结果缩放为原来的1/2.2次方
- 我们总是使用线性值来执行实际的计算，每当要显示结果或者访问可显示的图像（例如彩色纹理）时，我们就需要使用适当的编解码转换，来将数据转换到合适的编码格式中。

## 知道 HDR 吗？谈谈 HDR 和 Bloom 的关系？

-  [[HDR]] 是指高动态范围（High-Dynamic Range）它允许使用更宽的颜色空间和更宽广的亮度范围。
- Bloom 是指一个非常明亮的区域，其亮度溢出到相邻的像素上，是一种后处理技术。二者属于不同的技术，但是在画面效果上，有一定的相似之处。

在传统的LDR渲染管线中，所有物体的亮度都被限制在了`[0.0, 1.0]`。这会给Bloom的高亮区域提取 (Bright-Pass)步骤带来一个根本性的难题：无法区分“本身就很亮的物体”和“被照亮的白色物体”。

例如, 在一个LDR场景中，一个纯白色的灯罩和一个发光的灯泡，它们的像素值可能都是`(1.0, 1.0, 1.0)`。

而在一个HDR场景中，那个纯白色的灯罩的亮度值可能是`(0.9, 0.9, 0.9)`，而那个发光的灯泡，其亮度值可能是`(5.0, 5.0, 4.0)`。我们可以设置一个物理相关的值, 比如1,来区分这两者.
